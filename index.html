<!DOCTYPE html>
<html>
<head><title>Authenticating...</title></head>
<body>
  <p>Redirecting, please wait...</p>

  <script>
    const hashParams = new URLSearchParams(window.location.hash.substring(1));
    const queryParams = new URLSearchParams(window.location.search);
    const path = window.location.pathname.split('/').pop();

    const type = hashParams.get('type');
    const accessToken = hashParams.get('access_token');
    // Check both hash and query params for errors
    const error = hashParams.get('error_description') || hashParams.get('error')
                || queryParams.get('error_description') || queryParams.get('error');

    if (error) {
      window.location.href = "https://mantum.tech/error";
    } else if (type === 'signup' && accessToken) {
      window.location.href = "https://mantum.tech/emailcomf";
    } else if (type === 'recovery' && accessToken) {
      // Forward full hash for password reset
      window.location.href = "https://mantumtech.github.io/reset-password/" + window.location.hash;
    } else if (path === 'success' || queryParams.has('session_id')) {
      // Stripe payment success
      window.location.href = "https://mantum.tech/payment-success";
    } else if (path === 'cancelled') {
      // Stripe payment cancelled
      window.location.href = "https://mantum.tech/payment-cancelled";
    } else if (accessToken) {
      // Generic auth success
      window.location.href = "https://mantum.tech/emailcomf";
    } else {
      window.location.href = "https://mantum.tech/error";
    }
  </script>
</body>
</html>
